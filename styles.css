:root{
  --bg1:#ffd6e7;
  --bg2:#ffeef6;
  --ink:#2b2b2b;
  --paper:#fffafc;

  --env:#ff7aa6;
  --env2:#ff5f95;
  --shadow: rgba(0,0,0,.18);

  --seal:#c91b4a;
  --seal2:#a01239;

  --radius: 18px;
}

*{ box-sizing: border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--ink);
  background: radial-gradient(1200px 700px at 30% 10%, var(--bg2), var(--bg1));
  overflow-x:hidden;
}

/* CHANGED: top-aligned layout so title isn't covered */
.stage{
  min-height: 100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;      /* was center */
  gap: 18px;
  padding: 44px 18px 60px;         /* more top padding */
}

.title{
  margin: 0 0 8px;                 /* small extra spacing */
  font-size: clamp(1.35rem, 2.5vw, 2.2rem);
  letter-spacing:.2px;
  text-align:center;
}

.sub{
  margin:0;
  opacity:.8;
  font-size:.95rem;
}

kbd{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  padding: 2px 6px;
  border-radius: 8px;
  background: rgba(255,255,255,.6);
  box-shadow: 0 2px 0 rgba(0,0,0,.06);
}

.envelope-wrap{
  width: min(520px, 92vw);
  display:flex;
  justify-content:center;
  padding-top: 6px;
}

.envelope{
  position: relative;
  width: min(460px, 92vw);
  aspect-ratio: 4 / 3;
  cursor: pointer;
  outline: none;
  user-select:none;

  perspective: 1000px;
  transform-style: preserve-3d;
}

.envelope:focus-visible{
  box-shadow: 0 0 0 4px rgba(201,27,74,.25);
  border-radius: var(--radius);
}

.env-back{
  position:absolute;
  inset: 0;
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--env), var(--env2));
  box-shadow: 0 18px 45px var(--shadow);
}

.env-front{
  position:absolute;
  inset: 0;
  border-radius: var(--radius);
  background:
    linear-gradient(135deg, transparent 0 52%, rgba(255,255,255,.12) 52% 54%, transparent 54%) ,
    linear-gradient(225deg, transparent 0 52%, rgba(255,255,255,.12) 52% 54%, transparent 54%);
  pointer-events:none;
}

/* Front lower triangle */
.env-front::before{
  content:"";
  position:absolute;
  left:0; right:0; bottom:0;
  height: 62%;
  border-bottom-left-radius: var(--radius);
  border-bottom-right-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06));
  clip-path: polygon(0 0, 50% 62%, 100% 0, 100% 100%, 0 100%);
}

/* Left & right folds */
.env-front::after{
  content:"";
  position:absolute;
  inset: 0;
  border-radius: var(--radius);
  background:
    linear-gradient(135deg, rgba(0,0,0,.06), transparent 55%) left / 52% 100% no-repeat,
    linear-gradient(225deg, rgba(0,0,0,.06), transparent 55%) right / 52% 100% no-repeat;
  opacity:.65;
}

.env-flap{
  position:absolute;
  left:0; right:0; top:0;
  height: 56%;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.10));
  clip-path: polygon(0 0, 50% 78%, 100% 0, 100% 100%, 0 100%);
  transform-origin: top center;
  transform: rotateX(0deg) translateZ(2px);
  transition: transform 900ms cubic-bezier(.16, 1, .3, 1);
  pointer-events:none;
  z-index: 8;
}

.seal{
  position:absolute;
  left:50%;
  top: 58%;
  transform: translate(-50%, -50%);
  width: 78px;
  height: 78px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 30%, var(--seal), var(--seal2));
  box-shadow: 0 12px 24px rgba(0,0,0,.22);
  display:grid;
  place-items:center;
  z-index: 7;
  transition: transform 300ms ease, opacity 300ms ease;
}

.seal::before{
  content:"";
  position:absolute;
  inset: 10px;
  border-radius: 999px;
  border: 2px dashed rgba(255,255,255,.35);
  transform: rotate(8deg);
}

.seal-heart{
  font-size: 30px;
  color: rgba(255,255,255,.92);
  text-shadow: 0 2px 0 rgba(0,0,0,.15);
}

/* CHANGED: taller letter so it fits more content */
.letter{
  position:absolute;
  left: 7%;
  right: 7%;
  bottom: 10%;
  height: 86%;                     /* was 78% */
  border-radius: 14px;
  background: linear-gradient(180deg, var(--paper), #fff);
  box-shadow: 0 18px 40px rgba(0,0,0,.18);
  border: 1px solid rgba(0,0,0,.06);
  overflow:hidden;

  transform: translateY(80px) scale(.98);
  opacity: 0;
  z-index: 6;

  transition:
    transform 900ms cubic-bezier(.16, 1, .3, 1),
    opacity 500ms ease;
}

.letter-top,
.letter-bottom{
  display:flex;
  justify-content:space-between;
  gap: 12px;
  padding: 12px 14px;
  font-size: .92rem;
  background: linear-gradient(180deg, rgba(255,122,166,.10), transparent);
}

.letter-top{
  border-bottom: 1px dashed rgba(0,0,0,.08);
}

.letter-bottom{
  border-top: 1px dashed rgba(0,0,0,.08);
  align-items:center;

  /* CHANGED: grid layout so xoxo/button/hint never collide */
  display: grid;
  grid-template-columns: auto auto 1fr; /* xoxo | button | hint */
  gap: 12px;
}

.letter-body{
  padding: 14px 16px 18px;
  display:flex;
  flex-direction:column;
  gap: 14px;

  /* CHANGED: allow long messages without cutting off */
  max-height: calc(100% - 96px);
  overflow: auto;
}

.typed{
  margin:0;
  white-space: pre-wrap;
  line-height: 1.35;
  font-size: 1.05rem;
}

.hint{
  opacity:.75;
  font-size:.9rem;
  justify-self:end;
  text-align:right;
}

.xoxo{
  font-weight: 700;
  color: rgba(201,27,74,.9);
}

.actions{
  margin-top:auto;
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
}

.btn{
  appearance:none;
  border:none;
  cursor:pointer;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(201,27,74,.10);
  color: #7d1030;
  font-weight: 700;
  box-shadow: 0 8px 18px rgba(0,0,0,.10);
  transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
  white-space: nowrap;
}
.btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 22px rgba(0,0,0,.12); background: rgba(201,27,74,.14); }
.btn:active{ transform: translateY(0px) scale(.99); }

.btn-secondary{
  background: rgba(255,95,149,.10);
  color: #7a0f2f;
  justify-self:end;
  margin: 0;
}

/* OPEN STATE */
.envelope.open .env-flap{
  transform: rotateX(180deg) translateZ(2px);
}

/* Seal hidden when opened */
.envelope.open .seal{
  opacity: 0;
  transform: translate(-50%, -50%) scale(0);
  pointer-events: none;
}

/* CHANGED: lift the opened letter a bit more */
.envelope.open .letter{
  transform: translateY(-78px) scale(1); /* was -58/-62 */
  opacity: 1;
}

/* Floating hearts */
.hearts{
  position: fixed;
  inset: 0;
  pointer-events:none;
  overflow:hidden;
  z-index: 999;
}

.heart{
  position:absolute;
  font-size: 22px;
  transform: translate(0,0);
  animation: floatUp var(--dur, 1200ms) ease-out forwards;
  filter: drop-shadow(0 10px 12px rgba(0,0,0,.12));
  opacity: .95;
}

@keyframes floatUp{
  0%{ transform: translate(0,0) scale(.9); opacity: 0; }
  10%{ opacity: .95; }
  100%{ transform: translate(var(--dx, 0px), var(--dy, -220px)) scale(1.25); opacity: 0; }
}


